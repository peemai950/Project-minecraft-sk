# ---------------------------------------------------------
# FILE: 00_Main_Core.sk
# SYSTEM: Identity Card & Stats Core
# VERSION: v4.1 (Fix Syntax & Public Form)
# ---------------------------------------------------------

options:
    prefix: &8[&bSystem&8] &7
    
    # --- [Config] Items ---
    FORM_NAME: &e&l‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
    BOOK_DISPLAY_NAME: &6&l‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (Official ID)
    BOOK_TITLE: Identity Card
    BOOK_AUTHOR: ServerAdmin
    ID_LORE_HEADER: UUID
    
    # Custom Model Data
    FORM_MODEL_DATA: 1001 
    CARD_MODEL_DATA: 1002
    
    # --- [Config] Stats Balance ---
    MAX_LEVEL: 200
    
    # XP Cost
    XP_BASE_COST: 30
    XP_COST_SCALE: 5
    
    # Stats Scaling
    DMG_PER_LEVEL: 0.2   # STR
    DEF_PER_LEVEL: 0.1   # DEF
    SPD_PER_LEVEL: 0.003 # SPD
    DEX_PER_LEVEL: 0.2   # DEX
    
    # Vitality Setting
    HP_PER_LEVEL: 0.5    # 1 Level = 0.5 Hearts (1 HP)

# =========================================================
# 1. SHARED FUNCTIONS
# =========================================================

function calcPointCost(p: player) :: number:
    set {_uuid} to uuid of {_p}
    set {_total_points} to {rpg.str::%{_uuid}%} + {rpg.vit::%{_uuid}%} + {rpg.def::%{_uuid}%} + {rpg.spd::%{_uuid}%} + {rpg.dex::%{_uuid}%} + {rpg.points::%{_uuid}%}
    set {_cost} to {@XP_BASE_COST} + ({_total_points} * {@XP_COST_SCALE})
    return {_cost}

function getUpgradeCost(lvl: number) :: number:
    return 1 

function getSkillDescription(skill: text) :: text:
    if {_skill} contains "‡∏î‡∏π‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î":
        return "‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏Ñ‡∏∑‡∏ô"
    else if {_skill} contains "‡∏Ñ‡∏£‡∏¥‡∏ï‡∏¥‡∏Ñ‡∏≠‡∏•":
        return "‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 4 ‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏Ç‡∏∂‡πâ‡∏ô"
    else if {_skill} contains "‡∏û‡∏¥‡∏©":
        return "‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏ï‡∏¥‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏¥‡∏©"
    else if {_skill} contains "‡∏™‡∏≤‡∏¢‡∏ü‡πâ‡∏≤":
        return "‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏™‡∏≤‡∏¢‡∏ü‡πâ‡∏≤‡∏ü‡∏≤‡∏î‡∏®‡∏±‡∏ï‡∏£‡∏π"
    else if {_skill} contains "‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô":
        return "‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏î‡∏≤‡πÄ‡∏°‡∏à"
    else if {_skill} contains "‡∏´‡∏ô‡∏≤‡∏°‡∏¢‡∏≠‡∏Å":
        return "‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏î‡∏≤‡πÄ‡∏°‡∏à‡∏Å‡∏•‡∏±‡∏ö"
    else if {_skill} contains "‡∏ï‡∏∑‡πà‡∏ô‡∏ï‡∏±‡∏ß":
        return "‡∏ß‡∏¥‡πà‡∏á‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡∏ï‡∏µ"
    else if {_skill} contains "‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢":
        return "‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏Å‡∏£‡∏≤‡∏∞"
    else if {_skill} contains "‡∏ï‡∏≤‡πÄ‡∏´‡∏¢‡∏µ‡πà‡∏¢‡∏ß":
        return "‡∏¢‡∏¥‡∏á‡πÑ‡∏Å‡∏•‡πÅ‡∏£‡∏á‡∏Ç‡∏∂‡πâ‡∏ô"
    else if {_skill} contains "‡∏®‡∏£‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á":
        return "‡∏¢‡∏¥‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏®‡∏±‡∏ï‡∏£‡∏π‡πÄ‡∏î‡∏¥‡∏ô‡∏ä‡πâ‡∏≤"
    else if {_skill} contains "‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î":
        return "‡∏¢‡∏¥‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î"
    else if {_skill} contains "‡∏¢‡πà‡∏≤‡∏á‡∏Å‡πâ‡∏≤‡∏ß":
        return "‡∏¢‡∏¥‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏¥‡πà‡∏á‡πÄ‡∏£‡πá‡∏ß"
    else if {_skill} contains "‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π":
        return "‡∏£‡∏µ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥"
    else if {_skill} contains "‡∏Å‡∏£‡∏∞‡∏´‡∏≤‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏î":
        return "‡∏Ü‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏î/‡∏≠‡∏≤‡∏´‡∏≤‡∏£"
    else if {_skill} contains "‡∏ô‡∏±‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥":
        return "‡∏î‡∏£‡∏≠‡∏õ‡∏Ç‡∏≠‡∏á x2"
    else if {_skill} contains "‡πÄ‡∏à‡πâ‡∏≤‡∏™‡∏°‡∏∏‡∏ó‡∏£":
        return "‡πÄ‡∏Å‡πà‡∏á‡πÉ‡∏ô‡∏ô‡πâ‡∏≥"
    else if {_skill} contains "‡∏û‡∏∏‡πà‡∏á‡∏ï‡∏±‡∏ß":
        return "‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤‡∏î‡∏≤‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏∏‡πà‡∏á"
    else if {_skill} contains "‡∏™‡∏°‡∏≤‡∏ò‡∏¥":
        return "‡∏ô‡∏±‡πà‡∏á Shift ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏µ‡πÄ‡∏•‡∏∑‡∏≠‡∏î"
    else if {_skill} contains "‡πÄ‡∏´‡∏¥‡∏ô‡πÄ‡∏ß‡∏´‡∏≤":
        return "‡∏Å‡∏î Shift ‡∏¢‡πâ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏¥‡∏ô"
    else if {_skill} contains "‡∏à‡∏≤‡∏£‡∏∂‡∏Å":
        return "‡∏Ñ‡∏£‡∏≤‡∏ü‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÇ‡∏ï‡πä‡∏∞ Enchant"
    else if {_skill} contains "‡∏î‡∏≤‡∏ö‡∏ß‡∏≤‡∏¢‡∏∏":
        return "‡∏ï‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ü‡∏ï‡∏µ‡πÑ‡∏ß"
    else if {_skill} contains "‡∏û‡∏≤‡∏¢‡∏∏‡∏•‡∏π‡∏Å‡∏®‡∏£":
        return "‡∏¢‡∏¥‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏µ‡∏ù‡∏ô‡∏ò‡∏ô‡∏π‡∏ï‡∏Å‡πÉ‡∏™‡πà"
    return "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡πÄ‡∏®‡∏©"

function createProfileBook(p: player, custom_info: text) :: item:
    set {_book} to a written book
    set book title of {_book} to "{@BOOK_TITLE}"
    set book author of {_book} to "{@BOOK_AUTHOR}"
    set name of {_book} to "{@BOOK_DISPLAY_NAME}"
    set {_uuid} to uuid of {_p}
    
    set custom model data of {_book} to {@CARD_MODEL_DATA}
    
    # Initialize Stats
    if {rpg.str::%{_uuid}%} is not set:
        set {rpg.str::%{_uuid}%} to 0
    if {rpg.vit::%{_uuid}%} is not set:
        set {rpg.vit::%{_uuid}%} to 0
    if {rpg.def::%{_uuid}%} is not set:
        set {rpg.def::%{_uuid}%} to 0
    if {rpg.spd::%{_uuid}%} is not set:
        set {rpg.spd::%{_uuid}%} to 0
    if {rpg.dex::%{_uuid}%} is not set:
        set {rpg.dex::%{_uuid}%} to 0
    if {rpg.points::%{_uuid}%} is not set:
        set {rpg.points::%{_uuid}%} to 0
    
    if {passive.max_slots::%{_uuid}%} is not set:
        set {passive.max_slots::%{_uuid}%} to 3
        
    set {_total_lvl} to {rpg.str::%{_uuid}%} + {rpg.vit::%{_uuid}%} + {rpg.def::%{_uuid}%} + {rpg.spd::%{_uuid}%} + {rpg.dex::%{_uuid}%}
    set {_date} to now formatted as "dd/MM/yyyy"
    
    # --- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏à‡∏£‡∏¥‡∏á ---
    set {_bonus_str} to {rpg.str::%{_uuid}%} * {@DMG_PER_LEVEL}
    set {_bonus_hp} to {rpg.vit::%{_uuid}%} * {@HP_PER_LEVEL} * 2
    set {_total_hp_show} to 20 + {_bonus_hp}
    set {_bonus_def} to {rpg.def::%{_uuid}%} * {@DEF_PER_LEVEL}
    set {_bonus_spd} to {rpg.spd::%{_uuid}%} * {@SPD_PER_LEVEL} * 100
    set {_bonus_dex} to {rpg.dex::%{_uuid}%} * {@DEX_PER_LEVEL}
    
    # --- Page 1 ---
    set {_text_p1} to "&0&l[ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß ]%nl%"
    set {_text_p1} to "%{_text_p1}%&0‡∏ä‡∏∑‡πà‡∏≠: &1%{_p}%%nl%"
    set {_text_p1} to "%{_text_p1}%&0‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏£‡∏ß‡∏°: &2Lv.%{_total_lvl}%%nl%"
    
    set {_skills_equipped} to size of {passive.equipped::%{_uuid}%::*}
    set {_text_p1} to "%{_text_p1}%&0‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏Å‡∏¥‡∏•: &5%{_skills_equipped}%/%{passive.max_slots::%{_uuid}%}% Active%nl%"
    set {_text_p1} to "%{_text_p1}%&8(‡∏≠‡∏≠‡∏Å‡∏ö‡∏±‡∏ï‡∏£: %{_date}%)%nl%"
    
    set {_text_p1} to "%{_text_p1}%%nl%&0&l[ ‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á (Stats) ]%nl%"
    
    set {_text_p1} to "%{_text_p1}%&cSTR: %{rpg.str::%{_uuid}%}% &8(&4+%{_bonus_str}% Dmg&8)%nl%"
    set {_text_p1} to "%{_text_p1}%&aVIT: %{rpg.vit::%{_uuid}%}% &8(&2Max: %{_total_hp_show}% HP&8)%nl%"
    set {_text_p1} to "%{_text_p1}%&9DEF: %{rpg.def::%{_uuid}%}% &8(&3-%{_bonus_def}% Dmg&8)%nl%"
    set {_text_p1} to "%{_text_p1}%&bSPD: %{rpg.spd::%{_uuid}%}% &8(&3+%{_bonus_spd}%%% Walk&8)%nl%"
    set {_text_p1} to "%{_text_p1}%&2DEX: %{rpg.dex::%{_uuid}%}% &8(&a+%{_bonus_dex}% Bow&8)%nl%"
    
    set {_text_p1} to "%{_text_p1}%%nl%&5‡πÅ‡∏ï‡πâ‡∏°‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: %{rpg.points::%{_uuid}%}% SP%nl%"
    set {_text_p1} to "%{_text_p1}%&8&o(Shift+‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ã‡πâ‡∏≤‡∏¢: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏Å‡∏¥‡∏•)"
    
    set page 1 of {_book} to {_text_p1}
    
    # --- Page 2 ---
    set {_header} to "&0&l[ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ]%nl%"
    if {_custom_info} is set:
        if {_custom_info} is not "":
            set page 2 of {_book} to "%{_header}%%{_custom_info}%"
        else:
            set page 2 of {_book} to "%{_header}%&7(‡∏ß‡πà‡∏≤‡∏á)"
    else:
        set page 2 of {_book} to "%{_header}%&7(‡∏ß‡πà‡∏≤‡∏á)"

    # --- Page 3+ (Pagination) ---
    set {_page_cursor} to 3
    set {_skills_per_page} to 4
    set {_count_in_page} to 0
    set {_total_count} to 0
    
    set {_page_text} to "&0&l[ ‡∏™‡∏Å‡∏¥‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ]%nl%&8(Active Skills)%nl%%nl%"
    
    set {_equipped_list::*} to indices of {passive.equipped::%{_uuid}%::*}
    if size of {_equipped_list::*} is 0:
        set {_page_text} to "%{_page_text}%&8(‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏Å‡∏¥‡∏•)%nl%&8‡∏Å‡∏î Shift+‡∏ã‡πâ‡∏≤‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"
        set page {_page_cursor} of {_book} to {_page_text}
    else:
        loop {_equipped_list::*}:
            add 1 to {_total_count}
            add 1 to {_count_in_page}
            
            set {_skill_full_name} to loop-value
            set {_display_name} to {_skill_full_name}
            replace all "Passive: " and " (" and ")" with "" in {_display_name}
            set {_desc} to getSkillDescription({_display_name})
            
            set {_page_text} to "%{_page_text}%&1%{_total_count}%. &0%{_display_name}%%nl%&8> %{_desc}%%nl%%nl%"
            
            if {_count_in_page} >= {_skills_per_page}:
                set page {_page_cursor} of {_book} to {_page_text}
                add 1 to {_page_cursor}
                set {_count_in_page} to 0
                set {_page_text} to "&0&l[ ‡∏™‡∏Å‡∏¥‡∏• (‡∏ï‡πà‡∏≠) ]%nl%%nl%"
        
        if {_count_in_page} > 0:
            set page {_page_cursor} of {_book} to {_page_text}
    
    set lore of {_book} to "{@ID_LORE_HEADER}: %uuid of {_p}%", "&7(Shift+‡∏ã‡πâ‡∏≤‡∏¢: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏Å‡∏¥‡∏•)", "&e(Shift+‡∏Ç‡∏ß‡∏≤: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)"
    
    return {_book}

function getUpdatedBook(p: player, original: item) :: item:
    set {_pages::*} to pages of {_original}
    set {_old_info} to ""
    
    if {_pages::2} is set:
        set {_raw_text} to {_pages::2}
        
        replace all "&0&l[ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ]%nl%" with "" in {_raw_text}
        replace all "&0&l[ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ]" with "" in {_raw_text}
        replace all "&7(‡∏ß‡πà‡∏≤‡∏á)" with "" in {_raw_text}
        replace all "(‡∏ß‡πà‡∏≤‡∏á)" with "" in {_raw_text}
        replace all "&7(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)" with "" in {_raw_text}
        
        loop 5 times:
            replace all "%nl%%nl%" with new line in {_raw_text}
        
        if {_raw_text} is new line:
            set {_raw_text} to ""
            
        set {_old_info} to {_raw_text}

    if {_old_info} is "":
        set {_old_info} to ""

    return createProfileBook({_p}, {_old_info})

function updateIdBookInventory(p: player):
    loop all items in inventory of {_p}:
        set {_is_target} to false
        if custom model data of loop-item is {@CARD_MODEL_DATA}:
            set {_is_target} to true
        else if name of loop-item is "{@BOOK_DISPLAY_NAME}":
            if lore of loop-item contains "{@ID_LORE_HEADER}: %uuid of {_p}%":
                set {_is_target} to true
        if {_is_target} is true:
            set loop-item to getUpdatedBook({_p}, loop-item)

# --- GUI: Stats ---
function openStatsGUI(p: player):
    set {_gui} to a chest inventory with 5 rows named "&8&l‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á (Point System)"
    set {_uuid} to uuid of {_p}
    
    if {rpg.str::%{_uuid}%} is not set:
        set {rpg.str::%{_uuid}%} to 0
    if {rpg.vit::%{_uuid}%} is not set:
        set {rpg.vit::%{_uuid}%} to 0
    if {rpg.def::%{_uuid}%} is not set:
        set {rpg.def::%{_uuid}%} to 0
    if {rpg.spd::%{_uuid}%} is not set:
        set {rpg.spd::%{_uuid}%} to 0
    if {rpg.dex::%{_uuid}%} is not set:
        set {rpg.dex::%{_uuid}%} to 0
    if {rpg.points::%{_uuid}%} is not set:
        set {rpg.points::%{_uuid}%} to 0
    
    set {-temp.add.str::%{_uuid}%} to 0
    set {-temp.add.vit::%{_uuid}%} to 0
    set {-temp.add.def::%{_uuid}%} to 0
    set {-temp.add.spd::%{_uuid}%} to 0
    set {-temp.add.dex::%{_uuid}%} to 0
    
    set {_glass} to gray stained glass pane named "&7"
    loop integers between 0 and 44:
        set slot loop-value of {_gui} to {_glass}

    set {_click_msg} to "&e‡∏Ñ‡∏•‡∏¥‡∏Å (+1) | Shift+‡∏Ñ‡∏•‡∏¥‡∏Å (+10)"

    set slot 9 of {_gui} to iron sword named "&c‚öî ‡∏û‡∏•‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á (Strength)" with lore "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{rpg.str::%{_uuid}%}%", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡∏≤‡πÄ‡∏°‡∏à: &c+{@DMG_PER_LEVEL}", "", {_click_msg}
    set slot 11 of {_gui} to golden apple named "&a‚ù§ ‡∏û‡∏•‡∏±‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï (Vitality)" with lore "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{rpg.vit::%{_uuid}%}%", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: &2+{@HP_PER_LEVEL} Hearts", "", {_click_msg}
    set slot 13 of {_gui} to shield named "&9üõ° ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô (Defense)" with lore "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{rpg.def::%{_uuid}%}%", "&7‡∏•‡∏î‡∏î‡∏≤‡πÄ‡∏°‡∏à: &9-{@DEF_PER_LEVEL}", "", {_click_msg}
    set slot 15 of {_gui} to iron boots named "&büí® ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≠‡∏á‡πÑ‡∏ß (Agility)" with lore "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{rpg.spd::%{_uuid}%}%", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß: &b+{@SPD_PER_LEVEL}", "", {_click_msg}
    set slot 17 of {_gui} to bow named "&2üèπ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (Dexterity)" with lore "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{rpg.dex::%{_uuid}%}%", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡∏≤‡πÄ‡∏°‡∏à‡∏ò‡∏ô‡∏π: &a+{@DEX_PER_LEVEL}", "", {_click_msg}

    set slot 22 of {_gui} to book named "&f&l‡πÅ‡∏ï‡πâ‡∏°‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (Stat Points)" with lore "", "&d‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà: &f%{_current_points}% &d‡πÅ‡∏ï‡πâ‡∏°", "&7(‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏Å‡πÅ‡∏ï‡πâ‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á)"
    
    set {_current_cost} to calcPointCost({_p})
    set slot 30 of {_gui} to experience bottle named "&e&l‡πÅ‡∏•‡∏Å‡πÅ‡∏ï‡πâ‡∏° (Buy Point)" with lore "&7‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{_current_cost}% XP &7/ 1 SP", "&7(‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏™‡∏π‡∏á ‡∏¢‡∏¥‡πà‡∏á‡πÅ‡∏û‡∏á)", "", "&fXP ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: &a%total experience of {_p}%", "", "&e‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏Å!"
    
    set slot 32 of {_gui} to lime concrete named "&a&l‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î (Confirm)" with lore "&7‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á", "&7‡∏ó‡∏µ‡πà‡∏Å‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"
    set slot 31 of {_gui} to red concrete named "&c&l‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏µ‡πà‡∏Å‡∏î‡πÑ‡∏õ (Reset)" with lore "&7‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏î‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏µ‡πâ", "&7(‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏ï‡πâ‡∏°‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)"
    set slot 40 of {_gui} to arrow named "&c&l‚¨Ö ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö (Back)" with lore "&7‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏Å‡∏¥‡∏•"

    open {_gui} to {_p}

function refreshStatsGUI(p: player):
    set {_uuid} to uuid of {_p}
    set {_gui} to current inventory of {_p}
    
    set {_used} to {-temp.add.str::%{_uuid}%} + {-temp.add.vit::%{_uuid}%} + {-temp.add.def::%{_uuid}%} + {-temp.add.spd::%{_uuid}%} + {-temp.add.dex::%{_uuid}%}
    set {_current_points} to {rpg.points::%{_uuid}%} - {_used}
    
    set {_click_msg} to "&e‡∏Ñ‡∏•‡∏¥‡∏Å (+1) | Shift+‡∏Ñ‡∏•‡∏¥‡∏Å (+10)"
    
    # STR
    set {_lore_add} to "&a&l+ %{-temp.add.str::%{_uuid}%}% (‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô)"
    if ({rpg.str::%{_uuid}%} + {-temp.add.str::%{_uuid}%}) >= {@MAX_LEVEL}:
        set lore of slot 9 of {_gui} to "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &cMAX", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡∏≤‡πÄ‡∏°‡∏à: &c+{@DMG_PER_LEVEL}", "", "&c‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß!"
    else if {-temp.add.str::%{_uuid}%} > 0:
        set lore of slot 9 of {_gui} to "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{rpg.str::%{_uuid}%}%", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡∏≤‡πÄ‡∏°‡∏à: &c+{@DMG_PER_LEVEL}", "", {_lore_add}, {_click_msg}
    else:
        set lore of slot 9 of {_gui} to "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{rpg.str::%{_uuid}%}%", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡∏≤‡πÄ‡∏°‡∏à: &c+{@DMG_PER_LEVEL}", "", {_click_msg}

    # VIT
    set {_lore_add} to "&a&l+ %{-temp.add.vit::%{_uuid}%}% (‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô)"
    if ({rpg.vit::%{_uuid}%} + {-temp.add.vit::%{_uuid}%}) >= {@MAX_LEVEL}:
        set lore of slot 11 of {_gui} to "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &cMAX", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: &2+{@HP_PER_LEVEL} Hearts", "", "&c‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß!"
    else if {-temp.add.vit::%{_uuid}%} > 0:
        set lore of slot 11 of {_gui} to "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{rpg.vit::%{_uuid}%}%", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: &2+{@HP_PER_LEVEL} Hearts", "", {_lore_add}, {_click_msg}
    else:
        set lore of slot 11 of {_gui} to "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{rpg.vit::%{_uuid}%}%", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: &2+{@HP_PER_LEVEL} Hearts", "", {_click_msg}

    # DEF
    set {_lore_add} to "&a&l+ %{-temp.add.def::%{_uuid}%}% (‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô)"
    if ({rpg.def::%{_uuid}%} + {-temp.add.def::%{_uuid}%}) >= {@MAX_LEVEL}:
        set lore of slot 13 of {_gui} to "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &cMAX", "&7‡∏•‡∏î‡∏î‡∏≤‡πÄ‡∏°‡∏à: &9-{@DEF_PER_LEVEL}", "", "&c‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß!"
    else if {-temp.add.def::%{_uuid}%} > 0:
        set lore of slot 13 of {_gui} to "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{rpg.def::%{_uuid}%}%", "&7‡∏•‡∏î‡∏î‡∏≤‡πÄ‡∏°‡∏à: &9-{@DEF_PER_LEVEL}", "", {_lore_add}, {_click_msg}
    else:
        set lore of slot 13 of {_gui} to "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{rpg.def::%{_uuid}%}%", "&7‡∏•‡∏î‡∏î‡∏≤‡πÄ‡∏°‡∏à: &9-{@DEF_PER_LEVEL}", "", {_click_msg}

    # SPD
    set {_lore_add} to "&a&l+ %{-temp.add.spd::%{_uuid}%}% (‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô)"
    if ({rpg.spd::%{_uuid}%} + {-temp.add.spd::%{_uuid}%}) >= {@MAX_LEVEL}:
        set lore of slot 15 of {_gui} to "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &cMAX", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß: &b+{@SPD_PER_LEVEL}", "", "&c‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß!"
    else if {-temp.add.spd::%{_uuid}%} > 0:
        set lore of slot 15 of {_gui} to "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{rpg.spd::%{_uuid}%}%", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß: &b+{@SPD_PER_LEVEL}", "", {_lore_add}, {_click_msg}
    else:
        set lore of slot 15 of {_gui} to "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{rpg.spd::%{_uuid}%}%", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß: &b+{@SPD_PER_LEVEL}", "", {_click_msg}

    # DEX
    set {_lore_add} to "&a&l+ %{-temp.add.dex::%{_uuid}%}% (‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô)"
    if ({rpg.dex::%{_uuid}%} + {-temp.add.dex::%{_uuid}%}) >= {@MAX_LEVEL}:
        set lore of slot 17 of {_gui} to "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &cMAX", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡∏≤‡πÄ‡∏°‡∏à‡∏ò‡∏ô‡∏π: &a+{@DEX_PER_LEVEL}", "", "&c‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß!"
    else if {-temp.add.dex::%{_uuid}%} > 0:
        set lore of slot 17 of {_gui} to "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{rpg.dex::%{_uuid}%}%", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡∏≤‡πÄ‡∏°‡∏à‡∏ò‡∏ô‡∏π: &a+{@DEX_PER_LEVEL}", "", {_lore_add}, {_click_msg}
    else:
        set lore of slot 17 of {_gui} to "&7‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{rpg.dex::%{_uuid}%}%", "&7‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡∏≤‡πÄ‡∏°‡∏à‡∏ò‡∏ô‡∏π: &a+{@DEX_PER_LEVEL}", "", {_click_msg}

    set slot 22 of {_gui} to book named "&f&l‡πÅ‡∏ï‡πâ‡∏°‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (Stat Points)" with lore "", "&d‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà: &f%{_current_points}% &d‡πÅ‡∏ï‡πâ‡∏°", "&7(‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏Å‡πÅ‡∏ï‡πâ‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á)"
    
    set {_current_cost} to calcPointCost({_p})
    set slot 30 of {_gui} to experience bottle named "&e&l‡πÅ‡∏•‡∏Å‡πÅ‡∏ï‡πâ‡∏° (Buy Point)" with lore "&7‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: &f%{_current_cost}% XP &7/ 1 SP", "&7(‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏™‡∏π‡∏á ‡∏¢‡∏¥‡πà‡∏á‡πÅ‡∏û‡∏á)", "", "&fXP ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: &a%total experience of {_p}%", "", "&e‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏Å!"

# =========================================================
# 2. CORE COMMANDS & EVENTS
# =========================================================

# --- [‡πÉ‡∏´‡∏°‡πà] ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏™‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° (‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ) ---
command /getidform:
    trigger:
        set {_book} to writable book named "{@FORM_NAME}"
        set custom model data of {_book} to {@FORM_MODEL_DATA}
        
        # ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ ‡∏à‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ‡πÅ‡∏ó‡∏ô (‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡∏Ñ‡∏™‡∏µ‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô)
        set {_page1} to "       [ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß ]%nl%‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: Citizen%nl%------------------%nl%‡∏ä‡∏∑‡πà‡∏≠ IC: %nl%‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î: %nl%‡∏≠‡∏≤‡∏¢‡∏∏: %nl%[‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤]: %nl%"
        
        set page 1 of {_book} to {_page1}
        set lore of {_book} to "&e‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ô‡∏≤‡∏°", "&71. ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏™‡∏°‡∏∏‡∏î", "&72. ‡∏Å‡∏î Done (‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô)", "&e3. ‡∏Å‡∏î Shift+‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô"
        
        give {_book} to player
        send "{@prefix}&a‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß (‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß Shift+‡∏Ç‡∏ß‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô)" to player

command /givepointpaper <player> <number>:
    permission: op
    trigger:
        give paper named "&6&lüìÑ ‡πÉ‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ &e(+%arg-2% SP)" with lore "&7‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" to arg-1

on right click with paper:
    if uncolored name of tool contains "‡πÉ‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞":
        set {_name} to uncolored name of tool
        replace all "üìÑ ‡πÉ‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (+" and " SP)" with "" in {_name}
        set {_amount} to {_name} parsed as number
        if {_amount} is set:
            add {_amount} to {rpg.points::%uuid of player%}
            remove 1 of tool from player
            play sound "entity.player.levelup" at player
            send "{@prefix}&a‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö &e%{_amount}% SP &a‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!" to player

on inventory click:
    if name of event-inventory contains "‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á":
        cancel event
        set {_uuid} to uuid of player
        
        set {_used} to {-temp.add.str::%{_uuid}%} + {-temp.add.vit::%{_uuid}%} + {-temp.add.def::%{_uuid}%} + {-temp.add.spd::%{_uuid}%} + {-temp.add.dex::%{_uuid}%}
        set {_points} to {rpg.points::%{_uuid}%} - {_used}
        
        # 1. Add Stats (With Shift+Click Support)
        if index of event-slot is 9 or 11 or 13 or 15 or 17:
            
            set {_add_amount} to 1
            if "%click type%" contains "SHIFT":
                set {_add_amount} to 10
            
            # Check Points
            if {_points} < {_add_amount}:
                play sound "block.note_block.bass" at player
                send "{@prefix}&c‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏°‡πà‡∏û‡∏≠! ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ &e%{_add_amount}% SP" to player
                stop

            # Check Max Level
            set {_current_val} to 0
            if index of event-slot is 9:
                set {_current_val} to {rpg.str::%{_uuid}%} + {-temp.add.str::%{_uuid}%}
            else if index of event-slot is 11:
                set {_current_val} to {rpg.vit::%{_uuid}%} + {-temp.add.vit::%{_uuid}%}
            else if index of event-slot is 13:
                set {_current_val} to {rpg.def::%{_uuid}%} + {-temp.add.def::%{_uuid}%}
            else if index of event-slot is 15:
                set {_current_val} to {rpg.spd::%{_uuid}%} + {-temp.add.spd::%{_uuid}%}
            else if index of event-slot is 17:
                set {_current_val} to {rpg.dex::%{_uuid}%} + {-temp.add.dex::%{_uuid}%}
            
            if ({_current_val} + {_add_amount}) > {@MAX_LEVEL}:
                play sound "block.note_block.bass" at player
                send "{@prefix}&c‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î! (Max {@MAX_LEVEL})" to player
                stop

            # All good -> Add
            play sound "ui.button.click" at player
            if index of event-slot is 9:
                add {_add_amount} to {-temp.add.str::%{_uuid}%}
            else if index of event-slot is 11:
                add {_add_amount} to {-temp.add.vit::%{_uuid}%}
            else if index of event-slot is 13:
                add {_add_amount} to {-temp.add.def::%{_uuid}%}
            else if index of event-slot is 15:
                add {_add_amount} to {-temp.add.spd::%{_uuid}%}
            else if index of event-slot is 17:
                add {_add_amount} to {-temp.add.dex::%{_uuid}%}
            
            refreshStatsGUI(player)

        # 2. Buy Point
        else if index of event-slot is 30:
            set {_cost} to calcPointCost(player)
            if total experience of player >= {_cost}:
                remove {_cost} from total experience of player
                add 1 to {rpg.points::%{_uuid}%}
                play sound "entity.experience_orb.pickup" at player
                refreshStatsGUI(player)
            else:
                play sound "block.note_block.bass" at player
                send "{@prefix}&cXP ‡πÑ‡∏°‡πà‡∏û‡∏≠! ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ &e%{_cost}% XP" to player

        # 3. Reset
        else if index of event-slot is 31:
            set {-temp.add.str::%{_uuid}%} to 0
            set {-temp.add.vit::%{_uuid}%} to 0
            set {-temp.add.def::%{_uuid}%} to 0
            set {-temp.add.spd::%{_uuid}%} to 0
            set {-temp.add.dex::%{_uuid}%} to 0
            play sound "ui.interface.click" at player
            refreshStatsGUI(player)

        # 4. Confirm
        else if index of event-slot is 32:
            if {_used} > 0:
                remove {_used} from {rpg.points::%{_uuid}%}
                
                # Update Stats & Check Bonus
                if {-temp.add.str::%{_uuid}%} > 0:
                    add {-temp.add.str::%{_uuid}%} to {rpg.str::%{_uuid}%}
                    if mod({rpg.str::%{_uuid}%}, 10) = 0:
                        send "{@prefix}&6&lBONUS! &eStrength ‡∏Ñ‡∏£‡∏ö %{rpg.str::%{_uuid}%}% ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏°‡∏ü‡∏£‡∏µ +1" to player
                        add 1 to {rpg.points::%{_uuid}%}
                        play sound "ui.toast.challenge_complete" at player

                if {-temp.add.vit::%{_uuid}%} > 0:
                    add {-temp.add.vit::%{_uuid}%} to {rpg.vit::%{_uuid}%}
                    
                    # [APPLY MAX HEALTH] Base 20
                    set {_hp_bonus} to {rpg.vit::%{_uuid}%} * {@HP_PER_LEVEL}
                    set max health of player to 20 + {_hp_bonus}
                    
                    if mod({rpg.vit::%{_uuid}%}, 10) = 0:
                        send "{@prefix}&6&lBONUS! &aVitality ‡∏Ñ‡∏£‡∏ö %{rpg.vit::%{_uuid}%}% ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏°‡∏ü‡∏£‡∏µ +1" to player
                        add 1 to {rpg.points::%{_uuid}%}
                        play sound "ui.toast.challenge_complete" at player

                if {-temp.add.def::%{_uuid}%} > 0:
                    add {-temp.add.def::%{_uuid}%} to {rpg.def::%{_uuid}%}
                    if mod({rpg.def::%{_uuid}%}, 10) = 0:
                        send "{@prefix}&6&lBONUS! &9Defense ‡∏Ñ‡∏£‡∏ö %{rpg.def::%{_uuid}%}% ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏°‡∏ü‡∏£‡∏µ +1" to player
                        add 1 to {rpg.points::%{_uuid}%}
                        play sound "ui.toast.challenge_complete" at player

                if {-temp.add.spd::%{_uuid}%} > 0:
                    add {-temp.add.spd::%{_uuid}%} to {rpg.spd::%{_uuid}%}
                    set {_speed_bonus} to {rpg.spd::%{_uuid}%} * {@SPD_PER_LEVEL}
                    set walk speed of player to 0.2 + {_speed_bonus}
                    if mod({rpg.spd::%{_uuid}%}, 10) = 0:
                        send "{@prefix}&6&lBONUS! &bAgility ‡∏Ñ‡∏£‡∏ö %{rpg.spd::%{_uuid}%}% ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏°‡∏ü‡∏£‡∏µ +1" to player
                        add 1 to {rpg.points::%{_uuid}%}
                        play sound "ui.toast.challenge_complete" at player

                if {-temp.add.dex::%{_uuid}%} > 0:
                    add {-temp.add.dex::%{_uuid}%} to {rpg.dex::%{_uuid}%}
                    if mod({rpg.dex::%{_uuid}%}, 10) = 0:
                        send "{@prefix}&6&lBONUS! &2Dexterity ‡∏Ñ‡∏£‡∏ö %{rpg.dex::%{_uuid}%}% ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏°‡∏ü‡∏£‡∏µ +1" to player
                        add 1 to {rpg.points::%{_uuid}%}
                        play sound "ui.toast.challenge_complete" at player

                set {-temp.add.str::%{_uuid}%} to 0
                set {-temp.add.vit::%{_uuid}%} to 0
                set {-temp.add.def::%{_uuid}%} to 0
                set {-temp.add.spd::%{_uuid}%} to 0
                set {-temp.add.dex::%{_uuid}%} to 0
                
                play sound "entity.player.levelup" at player
                send "{@prefix}&a‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!" to player
                
                set {_p} to player
                updateIdBookInventory({_p})
                
                refreshStatsGUI(player)
            else:
                send "{@prefix}&c‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á‡πÉ‡∏î‡πÜ" to player

        # 5. Back Button
        else if index of event-slot is 40:
            delete {-temp.add.str::%{_uuid}%}
            delete {-temp.add.vit::%{_uuid}%}
            delete {-temp.add.def::%{_uuid}%}
            delete {-temp.add.spd::%{_uuid}%}
            delete {-temp.add.dex::%{_uuid}%}
            execute console command "sk reload RPG_System/03_Skill_Deck.sk"
            wait 1 tick
            openSkillDeckGUI(player)

on inventory close:
    if name of event-inventory contains "‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á":
        delete {-temp.add.str::%uuid of player%}
        delete {-temp.add.vit::%uuid of player%}
        delete {-temp.add.def::%uuid of player%}
        delete {-temp.add.spd::%uuid of player%}
        delete {-temp.add.dex::%uuid of player%}

# --- Events (Right Click, etc.) ---
on right click:
    if player is sneaking:
        # ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ã‡πá‡∏ô (Writable) ‡πÅ‡∏•‡∏∞‡πÄ‡∏ã‡πá‡∏ô‡πÅ‡∏•‡πâ‡∏ß (Written)
        if type of player's tool is writable book or written book:
            
            # ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á (1002) ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡πÑ‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏≠‡∏∑‡πà‡∏ô‡πÅ‡∏ó‡∏ô)
            if custom model data of player's tool is {@CARD_MODEL_DATA}:
                stop
            
            # --- [‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏°‡∏∏‡∏î‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏°‡πÅ‡∏Ç‡πá‡∏á‡∏Ç‡∏∂‡πâ‡∏ô] ---
            set {_is_form} to false
            
            # 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≤‡∏Å Model Data (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            if custom model data of player's tool is {@FORM_MODEL_DATA}:
                set {_is_form} to true
            
            # 2. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≤‡∏Å Lore (‡πÄ‡∏ú‡∏∑‡πà‡∏≠ Model Data ‡∏´‡∏≤‡∏¢)
            if {_is_form} is false:
                set {_lore::*} to lore of player's tool
                loop {_lore::*}:
                    if loop-value contains "‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ô‡∏≤‡∏°" or "Shift+‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤":
                        set {_is_form} to true
                        stop loop
            
            # 3. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô (‡πÄ‡∏ú‡∏∑‡πà‡∏≠ Lore ‡∏´‡∏≤‡∏¢)
            if {_is_form} is false:
                set {_pages::*} to pages of player's tool
                if {_pages::1} contains "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: Citizen":
                    set {_is_form} to true

            # --- [‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô] ---
            if {_is_form} is true:
                cancel event
                
                # ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ 1
                set {_pages::*} to pages of player's tool
                set {_custom_info} to ""
                if {_pages::1} is set:
                    set {_custom_info} to {_pages::1}
                
                # [‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢ Error] ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢‡πÜ
                if {_custom_info} contains "‡∏ä‡∏∑‡πà‡∏≠ IC:" and "‡∏≠‡∏≤‡∏¢‡∏∏:":
                    wait 1 tick # ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Empty Block Error
                else if length of {_custom_info} < 10:
                    send "{@prefix}&c‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏π‡∏ô‡πâ‡∏≠‡∏¢‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏™‡∏°‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏ô‡∏≤‡∏°!" to player
                    stop

                # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô
                set {_signed_book} to createProfileBook(player, {_custom_info})
                set player's tool to {_signed_book}
                
                # ‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Ñ‡πâ‡∏≤‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                delete {rpg.pending_registration::%uuid of player%}
                
                # Effect
                play sound "ui.cartography_table.take_result" at player
                execute console command "execute at %player% run particle happy_villager ~ ~1 ~ 0.5 0.5 0.5 0.1 10"
                send title "&a‡∏•‡∏á‡∏ô‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!" with subtitle "&7‡∏ö‡∏±‡∏ï‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß" to player for 3 seconds
            
            # ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡πà‡∏≤ (issueid)
            else if {rpg.pending_registration::%uuid of player%} is true:
                cancel event
                set {_pages::*} to pages of player's tool
                set {_custom_info} to ""
                if {_pages::1} is set:
                    set {_custom_info} to {_pages::1}
                set {_signed_book} to createProfileBook(player, {_custom_info})
                set player's tool to {_signed_book}
                delete {rpg.pending_registration::%uuid of player%}
                play sound "ui.cartography_table.take_result" at player
                execute console command "execute at %player% run particle happy_villager ~ ~1 ~ 0.5 0.5 0.5 0.1 10"
                send title "&a‡∏•‡∏á‡∏ô‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!" with subtitle "&7‡∏ö‡∏±‡∏ï‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß" to player for 3 seconds
            
            else:
                # ‡∏ñ‡πâ‡∏≤‡∏ñ‡∏∑‡∏≠‡∏™‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°" ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô
                if uncolored name of player's tool contains "‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°":
                    send "{@prefix}&c‡∏™‡∏°‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢) ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ç‡∏≠‡πÉ‡∏´‡∏°‡πà /getidform" to player

on right click with written book:
    set {_is_valid_card} to false
    if custom model data of tool is {@CARD_MODEL_DATA}:
        set {_is_valid_card} to true
    if name of tool is "{@BOOK_DISPLAY_NAME}":
        set {_is_valid_card} to true

    if {_is_valid_card} is true:
        set {_uuid_check} to "{@ID_LORE_HEADER}: %uuid of player%"
        set {_is_owner} to false
        loop lore of tool:
            if loop-value contains {_uuid_check}:
                set {_is_owner} to true
                stop loop
        
        if {_is_owner} is true:
            if player is sneaking:
                cancel event
                if clicked entity is a player:
                    set {_target} to clicked entity
                    make player swing hand
                    send "" to player, {_target}
                    send "&8&m--------&r &b‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô &8&m--------" to player, {_target}
                    send "&f‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏ö‡∏±‡∏ï‡∏£: &e%player%" to player, {_target}
                    
                    send "&fLevel: &cSTR:%{rpg.str::%uuid of player%}% &aVIT:%{rpg.vit::%uuid of player%}% &9DEF:%{rpg.def::%uuid of player%}%" to player, {_target}
                    
                    send "&8&m----------------------------" to player, {_target}
                    set player's tool to getUpdatedBook(player, player's tool)
                    send action bar "&a‚úî ‡∏¢‡∏∑‡πà‡∏ô‡∏ö‡∏±‡∏ï‡∏£‡πÉ‡∏´‡πâ %{_target}% ‡∏î‡∏π‡πÅ‡∏•‡πâ‡∏ß" to player
                    play sound "entity.villager.trade" at player
                else:
                    set player's tool to getUpdatedBook(player, player's tool)
                    send action bar "&a‚úî ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ö‡∏±‡∏ï‡∏£‡πÅ‡∏•‡πâ‡∏ß" to player
                    play sound "ui.button.click" at player

on left click with written book:
    set {_is_valid_card} to false
    if custom model data of tool is {@CARD_MODEL_DATA}:
        set {_is_valid_card} to true
    if name of tool is "{@BOOK_DISPLAY_NAME}":
        set {_is_valid_card} to true

    if {_is_valid_card} is true:
        set {_uuid_check} to "{@ID_LORE_HEADER}: %uuid of player%"
        set {_is_owner} to false
        loop lore of tool:
            if loop-value contains {_uuid_check}:
                set {_is_owner} to true
                stop loop
        
        if {_is_owner} is true:
            if player is sneaking:
                cancel event
                openSkillDeckGUI(player)
                play sound "ui.button.click" at player

on pickup:
    set {_is_card} to false
    if custom model data of event-item is {@CARD_MODEL_DATA}:
        set {_is_card} to true
    if name of event-item is "{@BOOK_DISPLAY_NAME}":
        set {_is_card} to true

    if {_is_card} is true:
        set {_lore} to line 1 of lore of event-item
        replace all "{@ID_LORE_HEADER}: " with "" in {_lore}
        if {_lore} is not "%uuid of player%":
            if player is not op:
                cancel event
                send action bar "&c‡∏ö‡∏±‡∏ï‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!" to player

every 2 seconds:
    loop all players:
        loop all items in inventory of loop-player:
            set {_is_card} to false
            if custom model data of loop-item is {@CARD_MODEL_DATA}:
                set {_is_card} to true
            if name of loop-item is "{@BOOK_DISPLAY_NAME}":
                set {_is_card} to true
            
            if {_is_card} is true:
                set {_lore} to line 1 of lore of loop-item
                replace all "{@ID_LORE_HEADER}: " with "" in {_lore}
                if {_lore} is not "%uuid of loop-player%":
                    if loop-player is not op:
                        drop loop-item at location of loop-player
                        remove loop-item from inventory of loop-player

command /issueid <player> <text>:
    permission: op
    usage: /issueid <‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô> <‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞>
    trigger:
        set {_target} to arg-1
        set {_status} to arg-2
        set {rpg.pending_registration::%uuid of {_target}%} to true
        
        set {_book} to writable book
        set name of {_book} to "{@FORM_NAME}"
        set custom model data of {_book} to {@FORM_MODEL_DATA}
        
        set {_page1} to "&0&l[ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß ]%nl%&0‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: &a%{_status}%%nl%&8&m------------------&r%nl%&0‡∏ä‡∏∑‡πà‡∏≠ IC: %nl%&0‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î: %nl%&0‡∏≠‡∏≤‡∏¢‡∏∏: %nl%&0[‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤]: %nl%"
        
        set page 1 of {_book} to {_page1}
        set lore of {_book} to "&e‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ô‡∏≤‡∏°", "&71. ‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏°‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", "&72. ‡∏Å‡∏î Done (‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô)", "&e3. ‡∏Å‡∏î Shift+‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô"
        
        give {_book} to {_target}
        send "{@prefix}&a‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡πâ %{_target}% ‡πÅ‡∏•‡πâ‡∏ß" to player
        send "{@prefix}&e‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°! ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏ñ‡∏∑‡∏≠‡∏™‡∏°‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Shift+‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤" to {_target}