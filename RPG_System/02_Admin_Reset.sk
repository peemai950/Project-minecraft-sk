# ---------------------------------------------------------
# FILE: RPG_System/02_Admin_Reset.sk
# SYSTEM: Admin Reset Tool (Advanced Category Menu)
# VERSION: v1.5 (Complete Reset)
# ---------------------------------------------------------

options:
    prefix: &8[&4&lADMIN&8] &7

# =========================================================
# 1. GUI FUNCTIONS
# =========================================================

# --- ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà ---
function openResetMenu(admin: player, target: player):
    set {_gui} to a chest inventory with 3 rows named "&8‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: &0%{_target}%"
    
    # Background
    set {_glass} to gray stained glass pane named "&7"
    loop integers between 0 and 26:
        set slot loop-value of {_gui} to {_glass}
    
    # 1. Reset Stats Only
    set slot 10 of {_gui} to diamond sword named "&b&l‚öî ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á (Stats Only)" with lore "&7‡∏•‡∏ö‡∏Ñ‡πà‡∏≤ STR, VIT, DEF, SPD, DEX", "&7‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏•‡∏∑‡∏≠‡∏î/‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏î‡∏¥‡∏ô", "&7(‡∏™‡∏Å‡∏¥‡∏•‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢)", "" and "&e‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"
    
    # 2. Reset Skills Only
    set slot 12 of {_gui} to enchanted book named "&e&lüìö ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏Å‡∏¥‡∏• (Skills Only)" with lore "&7‡∏•‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏°‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", "&7‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏Å‡∏¥‡∏•‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô 3 ‡∏ä‡πà‡∏≠‡∏á", "&7(‡∏Ñ‡πà‡∏≤ Stats ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢)", "" and "&e‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"
    
    # 3. Fix Status (Unstuck)
    set slot 14 of {_gui} to milk bucket named "&f&lüöë ‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Unstuck)" with lore "&7‡πÅ‡∏Å‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πà‡∏á/‡∏ö‡∏¥‡∏ô/‡πÄ‡∏î‡∏¥‡∏ô‡∏ä‡πâ‡∏≤", "&7(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢)", "" and "&e‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏±‡∏ô‡∏ó‡∏µ"

    # 4. Full Wipe
    set slot 16 of {_gui} to tnt named "&c&lüß® ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (Full Wipe)" with lore "&c‚ö† ‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢", "&7‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á Stats ‡πÅ‡∏•‡∏∞ Skills", "&7‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà 100%%", "" and "&e‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"

    open {_gui} to {_admin}

# --- ‡πÄ‡∏°‡∏ô‡∏π‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô (Confirmation) ---
function openConfirmAction(admin: player, target: player, type: text):
    set {_gui} to a chest inventory with 3 rows named "&4&l‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô: %{_type}%"
    
    set {_glass} to gray stained glass pane named "&7"
    loop integers between 0 and 26:
        set slot loop-value of {_gui} to {_glass}
        
    set slot 11 of {_gui} to red concrete named "&c&l‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å (Cancel)" with lore "&7‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å"
    set slot 15 of {_gui} to green concrete named "&a&l‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô (Confirm)" with lore "&7‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö: &e%{_target}%", "" and "&e‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô!"
    open {_gui} to {_admin}

# =========================================================
# 2. COMMANDS & LOGIC
# =========================================================

command /resetdata <player>:
    permission: op
    usage: /resetdata <‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô>
    trigger:
        set {_target} to arg-1
        openResetMenu(player, {_target})

# --- ‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Event ‡∏Ñ‡∏•‡∏¥‡∏Å ---
on inventory click:
    if name of event-inventory contains "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô":
        cancel event
        set {_t_name} to name of event-inventory
        replace all "&8‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: &0" with "" in {_t_name}
        set {_target} to {_t_name} parsed as player
        
        if event-slot is not empty:
            if type of event-item is gray stained glass pane:
                stop
                
            if index of event-slot is 10:
                openConfirmAction(player, {_target}, "STATS")
            else if index of event-slot is 12:
                openConfirmAction(player, {_target}, "SKILLS")
            else if index of event-slot is 14:
                execute console command "admin_action_exec %{_target}% UNSTUCK"
                close player's inventory
                send "{@prefix}&a‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡πâ &e%{_target}% &a‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢" to player
            else if index of event-slot is 16:
                openConfirmAction(player, {_target}, "FULL_WIPE")

    if name of event-inventory contains "&4&l‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô:":
        cancel event
        set {_action} to name of event-inventory
        replace all "&4&l‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô: " with "" in {_action}
        
        set {_lore} to line 1 of lore of slot 15 of event-inventory
        replace all "&7‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö: &e" with "" in {_lore}
        set {_target} to {_lore} parsed as player
        
        if event-slot is red concrete:
            openResetMenu(player, {_target}) 
            
        else if event-slot is green concrete:
            close player's inventory
            execute console command "admin_action_exec %{_target}% %{_action}%"
            send "{@prefix}&a‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ &e%{_action}% &a‡∏Å‡∏±‡∏ö &e%{_target}% &a‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!" to player

# --- ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á (Execution Logic) ---
command /admin_action_exec <player> <text>:
    permission: op
    trigger:
        set {_p} to arg-1
        set {_uuid} to uuid of {_p}
        set {_type} to arg-2
        
        # --- 1. Reset Stats ---
        if {_type} is "STATS" or "FULL_WIPE":
            delete {rpg.str::%{_uuid}%}
            
            # [FIX] Delete Vitality & Reset HP to 20
            delete {rpg.vit::%{_uuid}%}
            set max health of {_p} to 20 
            
            delete {rpg.def::%{_uuid}%}
            delete {rpg.spd::%{_uuid}%}
            delete {rpg.dex::%{_uuid}%}
            delete {rpg.points::%{_uuid}%}
            
            set walk speed of {_p} to 0.2
            send "{@prefix}&e‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á (Stats) ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï!" to {_p}

        # --- 2. Reset Skills ---
        if {_type} is "SKILLS" or "FULL_WIPE":
            delete {passive.skills::%{_uuid}%::*}
            delete {passive.equipped::%{_uuid}%::*}
            delete {passive.crit_stacks::%{_uuid}%}
            
            # ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏Å‡∏¥‡∏•‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (3)
            delete {passive.max_slots::%{_uuid}%}
            
            send "{@prefix}&e‡∏™‡∏Å‡∏¥‡∏•‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï!" to {_p}

        # --- 3. Unstuck / Clear Status ---
        if {_type} is "UNSTUCK" or "STATS" or "SKILLS" or "FULL_WIPE":
            delete {rpg.pending_registration::%{_uuid}%}
            delete {meditate.active::%{_uuid}%}
            delete {sky.flying::%{_uuid}%}
            
            # Clear Windblade
            if {windblade.active::%{_uuid}%} is set:
                execute console command "attribute %{_p}% minecraft:generic.attack_speed modifier remove 27586311-6666-7777-8888-999999999999"
                delete {windblade.active::%{_uuid}%}
            
            remove strength from {_p}
            remove speed from {_p}
            remove resistance from {_p}
            remove regeneration from {_p}
            remove slowness from {_p}
            
            if {_p} is gliding:
                set gliding of {_p} to false
            
            if {_type} is "UNSTUCK":
                play sound "entity.experience_orb.pickup" at {_p}
                send "{@prefix}&a‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÇ‡∏î‡∏¢ Admin" to {_p}

        # --- 4. Special for Full Wipe ---
        if {_type} is "FULL_WIPE":
            play sound "entity.wither.death" at {_p}
            kick {_p} due to "&c‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï!%nl%&7‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà"