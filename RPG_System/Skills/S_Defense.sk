options:
    DEF_PER_LEVEL: 0.05
    # Settings
    defense_chance: 30%
    defense_reduce: 0.3
    reflect_chance: 25%
    reflect_amount: 0.2
    adrenaline_chance: 30%

on damage:
    if victim is a player:
        set {_uuid} to uuid of victim

        # --- Defense Stat (‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ) ---
        if {rpg.def::%{_uuid}%} > 0:
            set {_reduce} to {rpg.def::%{_uuid}%} * {@DEF_PER_LEVEL}
            if damage > {_reduce}:
                remove {_reduce} from damage
            else:
                set damage to 0.5
        
        # --- Block (‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô equipped) ---
        set {_s} to "Passive: ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô (Defense)"
        if {passive.equipped::%{_uuid}%::%{_s}%} is set:
            if chance of {@defense_chance}:
                set {_r} to damage * {@defense_reduce}
                remove {_r} from damage
                play sound "item.shield.block" at victim
                send action bar "&büõ° Blocked!" to victim

        # --- Reflect (‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô equipped) ---
        set {_s} to "Passive: ‡∏´‡∏ô‡∏≤‡∏°‡∏¢‡∏≠‡∏Å (Reflect)"
        if {passive.equipped::%{_uuid}%::%{_s}%} is set:
            if chance of {@reflect_chance}:
                damage attacker by (damage * {@reflect_amount})
                play sound "item.shield.break" at victim

        # --- Adrenaline (‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô equipped) ---
        set {_s} to "Passive: ‡∏ï‡∏∑‡πà‡∏ô‡∏ï‡∏±‡∏ß (Adrenaline)"
        if {passive.equipped::%{_uuid}%::%{_s}%} is set:
            if chance of {@adrenaline_chance}:
                apply speed 2 to victim for 3 seconds

        # --- Last Stand (‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô equipped) ---
        set {_s} to "Passive: ‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ (Last Stand)"
        if {passive.equipped::%{_uuid}%::%{_s}%} is set:
            set {_fhp} to health of victim - damage
            set {_mhp} to max health of victim
            if ({_fhp} / {_mhp}) <= 0.3:
                apply resistance 2 to victim for 3 seconds
                play sound "item.armor.equip_diamond" at victim